#!/usr/bin/env bash
set -euo pipefail

print_icon() {
    case $1 in
        01*) echo "â˜€";;
        02*) echo "ğŸŒ¤";;
        03*) echo "ğŸŒ¥";;
        04*) echo "â˜";;
        09*) echo "ğŸŒ§";;
        10*) echo "ğŸŒ¦";;
        11*) echo "ğŸŒ©";;
        13*) echo "ğŸŒ¨";;
        50*) echo "ğŸŒ«";;
    esac
}

print_line() {

    # temps
    min=$(echo $1 | jq  '.temp.min')
    max=$(echo $1 | jq  '.temp.max')
    day=$(echo $1 | jq  '.temp.day')

    # date
    date=$(date -d @$(echo $1 | jq  '.dt') +'%A %m/%d')
    
    weather=$(echo $1 | jq -r '.weather[].icon')
    icon=$(print_icon $weather)
    echo "$date $icon: Day: $dayÂ°C Max: $maxÂ°C Min: $minÂ°C"
}

curl -s https://api.openweathermap.org/data/2.5/onecall\?lat\=48.9\&lon\=2.4667\&units\=metric\&exclude\=current,minutely,hourly\&appid\=$openweather_api_token|jq -cr '.daily[]' | sed -e 's/ /_/g' | while read -r i; do
    print_line $i
done


